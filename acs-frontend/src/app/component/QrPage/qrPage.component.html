<div class="container">
  <div class="panel left">
    <div class="card">
      <h2>產生門禁 QRCode</h2>
      <form (ngSubmit)="generateQrCode()" class="form">
        <input
          type="text"
          [(ngModel)]="userId"
          name="userId"
          placeholder="請輸入員編"
          required
        />
        <button type="submit">產生 QR Code</button>
      </form>

      <div class="qrcode-preview" *ngIf="qrCode || isQrExpired">
        <img
          [src]="qrCode"
          alt="QRCode"
          [style.filter]="isQrExpired ? 'grayscale(1) blur(1px)' : 'none'"
          [style.opacity]="isQrExpired ? 0.5 : 1"
        />

        <p class="caption" *ngIf="!isQrExpired">⏳ 請於 {{ countdown }} 秒內掃描</p>
        <p class="caption expired" *ngIf="isQrExpired">⚠️ QR Code 已過期，請重新產生</p>
      </div>

    </div>
  </div>

  <div class="panel right">
    <div class="card">
      <h2>開門紀錄</h2>

      <div *ngIf="isRequesting && !connectionError" class="status loading">
        🚀 資料讀取中...
      </div>

      <div *ngIf="connectionError" class="status error">
        ❌ WebSocket 連線失敗，請確認後端服務是否啟動
      </div>

      <ul *ngIf="!connectionError && accessRecords.length === 0" class="status empty">
        <li>尚無開門紀錄</li>
      </ul>

      <ul *ngIf="!connectionError && accessRecords.length > 0" class="record-list">
        <li *ngFor="let record of accessRecords" [class.success]="record.successful" [class.fail]="!record.successful">
          <div class="left-info">
            <div class="time">{{ record.accessTime | date:'yyyy-MM-dd HH:mm:ss' }}</div>
            <div class="userId">員編：{{ record.userId }}</div>
            <div class="cardId">卡號：{{ record.cardId }}</div>
            <div class="device">設備：{{ record.deviceId }}</div>
          </div>
          <div class="right-status">
            <div class="successful">
              {{ record.successful ? '✅ 成功' : '❌ 拒絕' }}
            </div>
            <div class="reason" *ngIf="record.reason">原因：{{ record.reason }}</div>
          </div>
        </li>
      </ul>
      
    </div>
  </div>
</div>
